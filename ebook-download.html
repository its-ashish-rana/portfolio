<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download: Software Engineer Guide Book</title>
  <link rel="stylesheet" href="css/scribbler-global.css">
  <link rel="stylesheet" href="css/scribbler-landing.css">
  <link rel="stylesheet" href="css/main.css">
  <style>
    .wrap { max-width: 780px; margin: 40px auto; padding: 0 16px; }
    .card { background: #fff; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,.06); padding: 20px; }
    .hidden { display: none; }
    .cta { display:inline-block; margin-top: 12px; background:#2e7d32; color:#fff; padding:10px 18px; border-radius:8px; text-decoration:none; }
  </style>
  <script>
    function query(k){ const u=new URL(window.location.href); return u.searchParams.get(k); }
    function isUnlocked() {
      try { return localStorage.getItem('ebook_paid') === 'true'; } catch(e) { return false; }
    }
    function guard() {
      var lockEl = document.getElementById('locked');
      var dlEl = document.getElementById('download');
      if (isUnlocked()) {
        lockEl.classList.add('hidden');
        dlEl.classList.remove('hidden');
      } else {
        lockEl.classList.remove('hidden');
        dlEl.classList.add('hidden');
      }
    }
    async function updateDownloadCount() {
      try {
        var ns = 'its-ashish-rana-portfolio';
        var key = 'ebook_downloads_v1';
        // create namespace/key if needed
        await fetch('https://api.countapi.xyz/create?namespace=' + ns + '&key=' + key + '&value=0', { method: 'GET' });
        var res = await fetch('https://api.countapi.xyz/hit/' + ns + '/' + key);
        var json = await res.json();
        var countEl = document.getElementById('download-count');
        if (countEl && json && json.value != null) { countEl.textContent = json.value; }
      } catch(e) { console.warn('CountAPI error', e); }
    }
    document.addEventListener('DOMContentLoaded', function(){ guard(); });
  </script>
</head>
<body>
  <nav class="header">
    <ul class="menu">
      <div class="menu__item toggle"><span></span></div>
      <li class="menu__item"><a href="index.html" class="link link--dark">Home</a></li>
      <li class="menu__item"><a href="ebook.html" class="link link--dark">eBook</a></li>
      <li class="menu__item"><a href="payments.html" class="link link--dark">Payments</a></li>
    </ul>
  </nav>
  <div class="wrap">
    <h1 class="section__title">Download Your eBook</h1>
    <div id="locked" class="card">
      <p>This download is locked. Please purchase the eBook for ₹99.</p>
      <a class="cta" href="payments.html?product=ebook&mrp=199&price=99&redirect=ebook-download.html">Pay ₹99 to Unlock</a>
    </div>
    <div id="download" class="card hidden">
      <p>Thanks for your support! Click below to download.</p>
      <a class="cta" href="docs/sample-ebook.pdf" download onclick="updateDownloadCount()">Download eBook PDF</a>
      <p style="margin-top:8px;">Download: <span id="download-count">0</span></p>
    </div>
  </div>
  <footer class="footer">© 2025, Ashish Rana</footer>
  <script src="js/scribbler.js"></script>
</body>
</html>
