<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payments - Support Ashish</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="css/scribbler-global.css">
    <link rel="stylesheet" href="css/scribbler-landing.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
      .payments-container { max-width: 980px; margin: 40px auto; padding: 0 16px; }
      .card { background: var(--color-white, #fff); border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,.06); padding: 24px; margin-bottom: 20px; }
      .card h2 { margin-top: 0; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
      .upi-box { text-align: center; }
      .upi-qr { width: 240px; height: 240px; object-fit: contain; border-radius: 8px; background: #fafafa; border: 1px solid #eee; }
      .note { font-size: 0.9rem; color: #666; }
      .pay-buttons a { display: inline-block; margin-right: 10px; margin-bottom: 10px; }
      .paypal-container { text-align: center; }
      .back-link { margin: 16px 0; display: inline-block; }
      @media (max-width: 768px) {
        .upi-qr { width: 200px; height: 200px; }
      }
    </style>
</head>
<body>
  <nav class="header">
    <ul class="menu">
      <div class="menu__item toggle"><span></span></div>
      <li class="menu__item"><a href="index.html" class="link link--dark"><i class="fas fa-home"></i> Home</a></li>
      <li class="menu__item"><a href="timeline.html" class="link link--dark"><i class="fas fa-history"></i> Timeline</a></li>
      <li class="menu__item"><a href="projects.html" class="link link--dark"><i class="fas fa-project-diagram"></i> Projects</a></li>
      <li class="menu__item"><a href="payments.html" class="link link--dark"><i class="fas fa-credit-card"></i> Payments</a></li>
    </ul>
  </nav>

  <div class="payments-container">
    <h1 class="section__title" id="checkout-title">Support My Work</h1>
    <div id="product-card" class="card" style="display:none;">
      <h2 id="product-title" style="margin:0 0 6px 0;">Checkout</h2>
      <p class="note" id="product-subtitle" style="margin:0 0 8px 0;"></p>
      <div class="price" id="product-price" style="font-weight:800; font-size:1.4rem;"></div>
      <p class="note" id="product-note" style="margin-top:6px;">Complete the payment below to unlock your download.</p>
      <div id="post-upi-actions" style="margin-top:10px; display:none;">
        <a id="mark-paid" class="button" style="padding:10px 16px; background:#1e88e5; color:#fff; border-radius:6px; text-decoration:none;" href="#">I've completed the UPI payment</a>
        <p class="note" id="manual-warning" style="margin-top:6px; display:none;">Manual unlock is disabled for this product. Please send payment receipt to rana.ashish1512@gmail.com to unlock.</p>
      </div>
    </div>

    <div class="grid">
      <section class="card upi-box">
        <h2>UPI Payment</h2>
        <p class="note">Follow the steps below to complete your payment:</p>
        
        <div style="text-align: left; margin: 20px 0; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #2e7d32;">
          <h3 style="margin-top: 0; color: #2e7d32;">Payment Instructions:</h3>
          <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
            <li>Open Paytm/GPay/PhonePe for payment</li>
            <li>Send payment to UPI ID: <strong style="color: #0a66c2;">6394697442@ptaxis</strong></li>
            <li>Enter the UPI name as mentioned: <strong>Ashish Rana</strong></li>
            <li>Enter the required amount</li>
            <li>Send payment and share the receipt/transaction screenshot to: <strong style="color: #d32f2f;">rana.ashish1512@gmail.com</strong></li>
          </ol>
        </div>

        <img class="upi-qr" id="upi-qr" src="" alt="UPI QR"/>
        <div style="margin-top:12px;">
          <a class="button" style="padding:10px 16px; background:#2e7d32; color:#fff; border-radius:6px; text-decoration:none;" id="upi-intent" href="#">Pay via UPI App</a>
        </div>
        <div class="app-links" style="margin-top:10px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
          <a id="paytm-link" class="button" style="padding:8px 12px; background:#02A7F0; color:#fff; border-radius:6px; text-decoration:none;" href="#">Pay on Paytm</a>
          <a id="phonepe-link" class="button" style="padding:8px 12px; background:#5F259F; color:#fff; border-radius:6px; text-decoration:none;" href="#">Pay on PhonePe</a>
          <a id="gpay-link" class="button" style="padding:8px 12px; background:#1A73E8; color:#fff; border-radius:6px; text-decoration:none;" href="#">Pay on GPay</a>
        </div>
        <p class="note" style="margin-top:8px;">Pay directly with UPI ID: <a id="upi-id-link" href="#" style="color:#0a66c2; text-decoration:underline;">6394697442@ptaxis</a></p>
        <p class="note" style="margin-top:8px;">Already paid via UPI? <a href="upi-claim.html">Submit your UPI reference</a> and we'll send the link.</p>
      </section>
    </div>

    <a class="back-link link link--dark" href="index.html"><i class="fas fa-arrow-left"></i> Back to Home</a>
  </div>

  <script src="js/scribbler.js"></script>
  <script>
    function getParam(name){ try { return new URL(window.location.href).searchParams.get(name); } catch(e){ return null; } }

    // UPI intent: replace with your actual UPI ID and suggested amount
    (function(){
      var upiId = '6394697442@ptaxis';
      var amount = getParam('price') || '100'; // INR
      var name = 'Ashish Rana';
      var product = getParam('product');
      var mrp = getParam('mrp');
      var note = (product === 'ebook') ? 'Software Engineer Guide Book' : 'Support donation';
      var tr = 'order-' + Math.random().toString(36).slice(2,10);
      var redirect = getParam('redirect');
      var upiIdLink = document.getElementById('upi-id-link');
      upiIdLink.textContent = upiId;
      var intent = 'upi://pay?pa=' + encodeURIComponent(upiId)
        + '&pn=' + encodeURIComponent(name)
        + '&tn=' + encodeURIComponent(note)
        + '&am=' + encodeURIComponent(amount)
        + '&cu=INR'
        + '&tr=' + encodeURIComponent(tr);
      var a = document.getElementById('upi-intent');
      a.setAttribute('href', intent);
      upiIdLink.setAttribute('href', intent);
      // App-specific deep links
      var paytmHref = 'paytmmp://pay?pa=' + encodeURIComponent(upiId)
        + '&pn=' + encodeURIComponent(name)
        + '&tn=' + encodeURIComponent(note)
        + '&am=' + encodeURIComponent(amount)
        + '&cu=INR'
        + '&tr=' + encodeURIComponent(tr);
      var phonepeHref = 'phonepe://pay?pa=' + encodeURIComponent(upiId)
        + '&pn=' + encodeURIComponent(name)
        + '&tn=' + encodeURIComponent(note)
        + '&am=' + encodeURIComponent(amount)
        + '&cu=INR'
        + '&tr=' + encodeURIComponent(tr);
      var gpayHref = 'tez://upi/pay?pa=' + encodeURIComponent(upiId)
        + '&pn=' + encodeURIComponent(name)
        + '&tn=' + encodeURIComponent(note)
        + '&am=' + encodeURIComponent(amount)
        + '&cu=INR'
        + '&tr=' + encodeURIComponent(tr);
      document.getElementById('paytm-link').setAttribute('href', paytmHref);
      document.getElementById('phonepe-link').setAttribute('href', phonepeHref);
      document.getElementById('gpay-link').setAttribute('href', gpayHref);
      var qrImg = document.getElementById('upi-qr');
      var qrApi = 'https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=' + encodeURIComponent(intent);
      qrImg.setAttribute('src', qrApi);

      // Desktop notice: UPI links open only on mobile devices
      var isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (!isMobile) {
        var noteEl = document.createElement('p');
        noteEl.className = 'note';
        noteEl.textContent = 'Tip: Open this page on your phone or scan the QR to pay via UPI.';
        document.querySelector('.upi-box').appendChild(noteEl);
      }

      // Product-specific header
      if (product) {
        var card = document.getElementById('product-card');
        var title = document.getElementById('product-title');
        var subtitle = document.getElementById('product-subtitle');
        var priceEl = document.getElementById('product-price');
        var postActions = document.getElementById('post-upi-actions');
        card.style.display = 'block';
        document.getElementById('checkout-title').textContent = 'Checkout';
        if (product === 'ebook') {
          title.textContent = 'Software Engineer Guide Book';
          subtitle.textContent = 'Reviewed by FANG/MANG engineers and IIT alumni';
        } else {
          title.textContent = 'Your Purchase';
          subtitle.textContent = '';
        }
        if (mrp && amount) {
          priceEl.innerHTML = '<s>₹' + mrp + '</s> ₹' + amount;
        } else if (amount) {
          priceEl.textContent = '₹' + amount;
        }

        // After UPI click, show info but disable manual unlock for ebook
        a.addEventListener('click', function(){
          setTimeout(function(){
            postActions.style.display = 'block';
            var warn = document.getElementById('manual-warning');
            if (product === 'ebook') {
              warn.style.display = 'block';
              document.getElementById('mark-paid').style.display = 'none';
            }
          }, 400);
        });

        // Mark as paid flow (only for non-ebook products)
        var markPaid = document.getElementById('mark-paid');
        markPaid.addEventListener('click', function(e){
          e.preventDefault();
          if (product === 'ebook') return; // guarded
          try {
            localStorage.setItem(product + '_paid', 'true');
          } catch(err) {}
          if (redirect) { window.location.href = redirect; }
        });
      }
    })();

  </script>
</body>
</html>
